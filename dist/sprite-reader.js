!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.SpriteReader=t()}}(function(){return function t(e,i,a){function n(r,h){if(!i[r]){if(!e[r]){var o="function"==typeof require&&require;if(!h&&o)return o(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var _=i[r]={exports:{}};e[r][0].call(_.exports,function(t){var i=e[r][1][t];return n(i?i:t)},_,_.exports,t,e,i,a)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<a.length;r++)n(a[r]);return n}({1:[function(t,e,i){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.autoplay,r=void 0===s?!0:s,h=n.canvas,o=void 0===h?null:h,c=n.fillColor,_=void 0===c?null:c,u=n.fps,l=void 0===u?30:u,f=n.from,g=void 0===f?0:f,d=n.loop,m=void 0===d?!1:d,p=n.onReady,v=void 0===p?null:p,y=n.onComplete,k=void 0===y?null:y,w=n.onRepeat,C=void 0===w?null:w,x=n.onRepeatComplete,T=void 0===x?null:x,P=n.repeat,R=void 0===P?0:P,S=n.retina,j=void 0===S?!1:S,z=n.reverse,b=void 0===z?!1:z,E=n.to,M=void 0===E?null:E;if(a(this,t),!e)throw new Error("image parameter can not be null");if(!i)throw new Error("json parameter can not be null");if(e.length&&i.length&&e.length!==i.length)throw new Error("image length must be equal to json length");if(this._image=e,this._json=i,this._canvasCache=[],this._ctxCache=[],this._packCached=0,this._canvasTarget=o||document.createElement("canvas"),this._ctxTarget=null,this._multipackSize=e.length||1,this._currentPack=0,this._currentRepeat=0,this._from=g,this._current=g,this._to=M,this._isPlaying=r,this._repeat=m?-1:R,this._fillColor=_,this._interval=1e3/l,this._then=null,this._onReady=v,this._onComplete=k,this._onRepeat=C,this._onRepeatComplete=T,this._image.length||(this._image=[this._image]),this._json.length||(this._json=[this._json]),null===this._to){for(var O=0,q=0;q<this._multipackSize;q++)O+=this._json[q].frames.length;this._to=O-1}if(this._side=b||this._from>this._to?-1:1,-1===this._side&&this._from<this._to){var I=this._from,D=this._to;this._from=Math.max(I,D),this._to=Math.min(I,D)}for(var N=document.createElement("canvas"),F=0;F<this._multipackSize;F++)this._canvasCache[F]=N.cloneNode(!1),this._canvasCache[F].width=this._json[F].meta.size.w,this._canvasCache[F].height=this._json[F].meta.size.h,this._ctxCache[F]=this._canvasCache[F].getContext("2d");o||(this._canvasTarget.width=this._json[0].frames[0].sourceSize.w,this._canvasTarget.height=this._json[0].frames[0].sourceSize.h,Object.assign(this._canvasTarget.style,{width:this._canvasTarget.width/(j?2:1)+"px",height:this._canvasTarget.height/(j?2:1)+"px"})),this._ctxTarget=this._canvasTarget.getContext("2d"),_&&(this._ctxTarget.fillStyle=_),this.update(!0)}return n(t,[{key:"findPack",value:function(){for(var t=0,e=0;this._current>t;)t+=this._json[e].frames.length,this._current>t&&e++;this._currentPack=e}},{key:"checkPack",value:function(){this.getCurrentRelatedToPack()>this._json[this._currentPack].frames.length-1&&(this._currentPack<this._multipackSize-1?this._currentPack++:this._currentPack=0)}},{key:"getCurrentRelatedToPack",value:function(){for(var t=0,e=0;e<this._currentPack;e++)t+=this._json[e].frames.length;return this._current-t}},{key:"drawCache",value:function(){var t=this._packCached,e=document.createElement("canvas"),i=e.getContext("2d");e.width=this._canvasCache[t].width,e.height=this._canvasCache[t].height,i.drawImage(this._image[t],0,0);var a=i.getImageData(0,0,e.width,e.height);this._ctxCache[t].putImageData(a,0,0),this._packCached++,this._packCached===this._multipackSize&&this._onReady&&this._onReady()}},{key:"draw",value:function(){var t=this._canvasTarget;this.checkPack();var e=this._json[this._currentPack].frames[this.getCurrentRelatedToPack()],i={w:e.frame.w,h:e.frame.h},a={x:0,y:0};this._ctxTarget.clearRect(0,0,t.width,t.height),this._fillColor&&this._ctxTarget.fillRect(0,0,t.width,t.height),e.rotated&&(this._ctxTarget.save(),this._ctxTarget.translate(t.width/2,t.height/2),this._ctxTarget.rotate(-Math.PI/2),this._ctxTarget.translate(-t.height/2,-t.width/2),i.w=e.frame.h,i.h=e.frame.w),e.trimmed&&(a.x=e.spriteSourceSize.x,a.y=e.spriteSourceSize.y,e.rotated&&(a.x=t.height-e.spriteSourceSize.h-e.spriteSourceSize.y,a.y=e.spriteSourceSize.x)),this._ctxTarget.drawImage(this._canvasCache[this._currentPack],e.frame.x,e.frame.y,i.w,i.h,a.x,a.y,i.w,i.h),e.rotated&&this._ctxTarget.restore()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;if(this._packCached<this._multipackSize&&this.drawCache(),this._isPlaying||t){var e=performance.now(),i=e-this._then;i<this._interval&&!t||(this._then=e-i%this._interval,this.draw(),this._current===this._to?this._repeat?(this._currentRepeat++,this._current=this._from,this._currentPack=0,this._onRepeat&&this._onRepeat(),this._repeat>0&&this._currentRepeat>this._repeat&&(this._isPlaying=!1,this._onRepeatComplete&&this._onRepeatComplete())):(this._isPlaying=!1,this._onComplete&&this._onComplete()):this._current+=this._side)}}},{key:"play",value:function(){this._isPlaying=!0}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this._isPlaying=!1,this._current=this._from}},{key:"reverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==t?this._side=t?1:-1:this._side=1===this._side?-1:1;var e=this._from,i=this._to;this._from=1===this._side?Math.min(e,i):Math.max(e,i),this._to=1===this._side?Math.max(e,i):Math.min(e,i)}},{key:"goFromTo",value:function(t,e){t>=0&&(this._from=t),e>=0&&(this._to=e),this._current=this._from,this._side=t>e?-1:1,this.findPack()}},{key:"goToAndStop",value:function(t){this._current=t,this._isPlaying=!1}},{key:"destroy",value:function(){this._isPlaying=!1,this._ctxTarget.clearRect(0,0,this._canvasTarget.width,this._canvasTarget.height)}},{key:"canvas",get:function(){return this._canvasTarget}},{key:"fps",set:function(t){this._interval=1e3/t}},{key:"loop",set:function(t){t?this._repeat=-1:-1===this._repeat&&(this._repeat=0)}},{key:"repeat",set:function(t){this._repeat=t,this._currentRepeat=0}},{key:"onComplete",set:function(t){this._onComplete=t}},{key:"onRepeat",set:function(t){this._onRepeat=t}},{key:"onRepeatComplete",set:function(t){this._onRepeatComplete=t}}]),t}();i["default"]=s},{}]},{},[1])(1)});
//# sourceMappingURL=sprite-reader.js.map