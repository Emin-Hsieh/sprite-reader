(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),SpriteReader=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.image,a=void 0===i?null:i,s=e.json,h=void 0===s?null:s,n=e.autoplay,r=void 0===n?!0:n,o=e.canvas,c=void 0===o?null:o,_=e.fillColor,l=void 0===_?null:_,u=e.fps,g=void 0===u?30:u,p=e.from,m=void 0===p?0:p,d=e.loop,v=void 0===d?!1:d,f=e.onReady,k=void 0===f?null:f,y=e.onComplete,C=void 0===y?null:y,w=e.onRepeat,x=void 0===w?null:w,P=e.onRepeatComplete,T=void 0===P?null:P,R=e.repeat,S=void 0===R?0:R,j=e.retina,z=void 0===j?!1:j,b=e.to,E=void 0===b?null:b;if(_classCallCheck(this,t),!a)throw new Error("image parameter can not be null");if(!h)throw new Error("json parameter can not be null");if(a.length&&h.length&&a.length!==h.length)throw new Error("image length must be equal to json length");if(this._image=a,this._json=h,this._canvasCache=[],this._ctxCache=[],this._packCached=0,this._canvasTarget=c||document.createElement("canvas"),this._ctxTarget=null,this._multipackSize=a.length||1,this._currentPack=0,this._currentRepeat=0,this._from=m,this._current=m,this._to=E,this._isPlaying=r,this._repeat=v?-1:S,this._fillColor=l,this._interval=1e3/g,this._then=null,this._onReady=k,this._onComplete=C,this._onRepeat=x,this._onRepeatComplete=T,this._image.length||(this._image=[this._image]),this._json.length||(this._json=[this._json]),null===this._to){for(var M=0,I=0;I<this._multipackSize;I++)M+=this._json[I].frames.length;this._to=M-1}this._side=this._from>this._to?-1:1;for(var O=document.createElement("canvas"),D=0;D<this._multipackSize;D++)this._canvasCache[D]=O.cloneNode(!1),this._canvasCache[D].width=this._json[D].meta.size.w,this._canvasCache[D].height=this._json[D].meta.size.h,this._ctxCache[D]=this._canvasCache[D].getContext("2d");c||(this._canvasTarget.width=this._json[0].frames[0].sourceSize.w,this._canvasTarget.height=this._json[0].frames[0].sourceSize.h,Object.assign(this._canvasTarget.style,{width:this._canvasTarget.width/(z?2:1)+"px",height:this._canvasTarget.height/(z?2:1)+"px"})),this._ctxTarget=this._canvasTarget.getContext("2d"),l&&(this._ctxTarget.fillStyle=l),this.update(!0)}return _createClass(t,[{key:"findPack",value:function(){for(var t=0,e=0;this._current>t;)t+=this._json[e].frames.length,this._current>t&&e++;this._currentPack=e}},{key:"checkPack",value:function(){this.getCurrentRelatedToPack()>this._json[this._currentPack].frames.length-1&&(this._currentPack<this._multipackSize-1?this._currentPack++:this._currentPack=0)}},{key:"getCurrentRelatedToPack",value:function(){for(var t=0,e=0;e<this._currentPack;e++)t+=this._json[e].frames.length;return this._current-t}},{key:"drawCache",value:function(t){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=this._canvasCache[t].width,e.height=this._canvasCache[t].height,i.drawImage(this._image[t],0,0);var a=i.getImageData(0,0,e.width,e.height);this._ctxCache[t].putImageData(a,0,0),this._packCached++,this._packCached===this._multipackSize&&this._onReady&&this._onReady()}},{key:"draw",value:function(){var t=this._canvasTarget;this.checkPack();var e=this._json[this._currentPack].frames[this.getCurrentRelatedToPack()],i={w:e.frame.w,h:e.frame.h},a={x:0,y:0};this._ctxTarget.clearRect(0,0,t.width,t.height),this._fillColor&&this._ctxTarget.fillRect(0,0,t.width,t.height),e.rotated&&(this._ctxTarget.save(),this._ctxTarget.translate(t.width/2,t.height/2),this._ctxTarget.rotate(-Math.PI/2),this._ctxTarget.translate(-t.height/2,-t.width/2),i.w=e.frame.h,i.h=e.frame.w),e.trimmed&&(a.x=e.spriteSourceSize.x,a.y=e.spriteSourceSize.y,e.rotated&&(a.x=t.height-e.spriteSourceSize.h-e.spriteSourceSize.y,a.y=e.spriteSourceSize.x)),this._ctxTarget.drawImage(this._canvasCache[this._currentPack],e.frame.x,e.frame.y,i.w,i.h,a.x,a.y,i.w,i.h),e.rotated&&this._ctxTarget.restore()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;if(this._packCached<this._multipackSize&&this.drawCache(this._packCached),this._isPlaying||t){var e=performance.now(),i=e-this._then;i<this._interval&&!t||(this._then=e-i%this._interval,this.draw(),this._current===this._to?this._repeat?(this._currentRepeat++,this._current=this._from,this._currentPack=0,this._onRepeat&&this._onRepeat(),this._repeat>0&&this._currentRepeat>this._repeat&&(this._isPlaying=!1,this._onRepeatComplete&&this._onRepeatComplete())):(this._isPlaying=!1,this._onComplete&&this._onComplete()):this._current+=this._side)}}},{key:"play",value:function(){this._isPlaying=!0}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this._isPlaying=!1,this._current=this._from}},{key:"reverse",value:function(t){1===t||-1===t?this._side=t:this._side=1===this._side?-1:1;var e=this._from,i=this._to;1===this._side?this._from=Math.min(e,i):Math.max(e,i),1===this._side?this._to=Math.max(e,i):Math.min(e,i)}},{key:"goFromTo",value:function(t,e){t>=0&&(this._from=t),e>=0&&(this._to=e),this._current=this._from,this._side=t>e?-1:1,this.findPack()}},{key:"goToAndStop",value:function(t){this._current=t,this._isPlaying=!1}},{key:"destroy",value:function(){this._isPlaying=!1,this._ctxTarget.clearRect(0,0,this._canvasTarget.width,this._canvasTarget.height)}},{key:"canvas",get:function(){return this._canvasTarget}},{key:"fps",set:function(t){this._interval=1e3/t}},{key:"loop",set:function(t){t?this._repeat=-1:-1===this._repeat&&(this._repeat=0)}},{key:"repeat",set:function(t){this._repeat=t,this._currentRepeat=0}},{key:"onComplete",set:function(t){this._onComplete=t}},{key:"onRepeat",set:function(t){this._onRepeat=t}},{key:"onRepeatComplete",set:function(t){this._onRepeatComplete=t}}]),t}();exports["default"]=SpriteReader;

},{}]},{},[1])
//# sourceMappingURL=sprite-reader.js.map
